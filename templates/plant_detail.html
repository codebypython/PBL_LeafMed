{% extends "base.html" %}
{% block content %}
  <div class="card">
    <div class="plant-header">
      <h2>{{ plant.name }}</h2>
      {% if plant.scientific_name %}
        <div class="plant-scientific">{{ plant.scientific_name }}</div>
      {% endif %}
    </div>

    <div class="info-section">
      {% if plant.biological_info %}
        <h3>ThÃ´ng tin sinh há»c</h3>
        <p>{{ plant.biological_info|linebreaks }}</p>
      {% endif %}
      {% if plant.medicinal_info %}
        <h3>ThÃ´ng tin dÆ°á»£c há»c</h3>
        <p>{{ plant.medicinal_info|linebreaks }}</p>
      {% endif %}
    </div>

    <!-- CÃ´ng thá»©c cháº¿ biáº¿n -->
    {% if recipes %}
    <div class="info-section" style="margin-top: 2rem;">
      <h3>ğŸ§ª CÃ´ng thá»©c cháº¿ biáº¿n ({{ recipes.count }})</h3>
      <div class="recipes-list">
        {% for recipe in recipes %}
          <a href="{% url 'recipe_detail' recipe.id %}" class="recipe-item">
            <div class="recipe-icon-header">
              {% if recipe.image %}
                <img src="{{ recipe.image.url }}" alt="{{ recipe.name }}" class="recipe-card-image">
              {% else %}
                <div class="recipe-no-image">
                  <span class="recipe-icon">
                    {% if recipe.recipe_type == 'tea' %}â˜•
                    {% elif recipe.recipe_type == 'juice' %}ğŸ¥¤
                    {% elif recipe.recipe_type == 'paste' %}ğŸ§´
                    {% elif recipe.recipe_type == 'powder' %}ğŸ¥„
                    {% elif recipe.recipe_type == 'oil' %}ğŸ«—
                    {% elif recipe.recipe_type == 'tincture' %}ğŸ¶
                    {% elif recipe.recipe_type == 'syrup' %}ğŸ¯
                    {% else %}ğŸ“¦{% endif %}
                  </span>
                </div>
              {% endif %}
            </div>
            <div class="recipe-content">
              <h4 class="recipe-name">{{ recipe.name }}</h4>
              <div class="recipe-meta">
                <span class="badge badge-info">{{ recipe.get_recipe_type_display }}</span>
                <span class="badge {% if recipe.difficulty == 'easy' %}badge-success{% elif recipe.difficulty == 'medium' %}badge-info{% else %}badge-danger{% endif %}">
                  {{ recipe.get_difficulty_display }}
                </span>
                <span class="badge">{{ recipe.get_usage_method_display }}</span>
                {% if recipe.preparation_time %}
                  <span style="font-size: 0.9rem; color: var(--text-secondary);">â± {{ recipe.preparation_time }} phÃºt</span>
                {% endif %}
              </div>
              {% if recipe.treats %}
                <p class="recipe-treats">Äiá»u trá»‹: {{ recipe.treats|truncatewords:12 }}</p>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <h3>áº¢nh Ä‘Ã£ chá»¥p gáº§n Ä‘Ã¢y</h3>
    {% if recent_captures %}
      <div class="grid">
        {% for cap in recent_captures %}
        <div class="thumb-card">
          {% if cap.local_image %}
            <img class="thumb-image" src="{{ cap.local_image.url }}" alt="">
          {% else %}
            <img class="thumb-image" src="{{ pi_base }}/history/image/{{ cap.image_file }}" alt="">
          {% endif %}
          <div class="thumb-body">
            <div class="thumb-title">{{ cap.created_at|date:"Y-m-d H:i" }} â€” {{ cap.confidence|floatformat:3 }}</div>
            {% if cap.local_image %}
              <a class="btn btn-secondary btn-sm" href="{{ cap.local_image.url }}" target="_blank">Má»Ÿ áº£nh</a>
            {% elif cap.image_file %}
              <a class="btn btn-secondary btn-sm" href="{{ pi_base }}/history/image/{{ cap.image_file }}" target="_blank">Má»Ÿ áº£nh</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
      </div>
    {% else %}
      <p>ChÆ°a cÃ³ káº¿t quáº£ tra cá»©u nÃ o Ä‘Æ°á»£c lÆ°u.</p>
    {% endif %}
  </div>
{% endblock %}